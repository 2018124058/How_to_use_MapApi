{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>홈 화면 지도: 즐겨찾기 + 일반 공연 </h1>
    <!--지도 담을 영역 지정-->
	<div id="home_map" style="width:500px;height:400px;"></div>
    <hr>
	<!--api 및 라이브러리(services) 불러오기-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8692f5c3c759c152297171d014cffebe"></script>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8692f5c3c759c152297171d014cffebe&libraries=services"></script>
    <div id = "inform_list"></div>
    
    <script>
        // 지도 생성 및 영역에 담기
		var container = document.getElementById('home_map');
		var options = {
			center: new kakao.maps.LatLng(33.450701, 126.570667),
			level: 3
		};

		var home_map = new kakao.maps.Map(container, options);

        // 사용자 위치 표시 및 지도 중심으로 설정 
        if (navigator.geolocation){ //geolocation 사용 가능할 때
            // 현재 위치 
            navigator.geolocation.getCurrentPosition(function(position){
                var lat = position.coords.latitude, // 위도
                lon = position.coords.longitude; // 경도 

                var locPosition = new kakao.maps.LatLng(lat, lon); // 현재 위치 생성
                displayMarker(locPosition); // 마커 표시 및 지도 중심 옮기기 
            })
        }
        else{ // geolocation 사용 불가  
            var locPosition = new kakao.maps.LatLng(33.450701, 126.570667);
            displayMarker(locPosition);
        }

        function displayMarker(locPosition){
            var marker = new kakao.maps.Marker({
                map: home_map,
                position: locPosition
            });

            // 지도 중심좌표를 현재 위치로 변경 
            home_map.setCenter(locPosition);
        }


        // 즐겨찾기 마커: favorite_positions
        var favorite_positions = [
            {
                title: '즐겨찾기 공연1',  // title은 공연 이름으로 
                latlng: new kakao.maps.LatLng(33.450705, 126.570677) // 위치의 위도, 경도 
            },
            {
                title: '즐겨찾기 공연2', 
                latlng: new kakao.maps.LatLng(33.450936, 126.569477)
            },
        ];
        
        // 마커 이미지
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";
        
        for (var i = 0; i < favorite_positions.length; i ++) {

            // 마커 이미지의 이미지 크기
            var imageSize = new kakao.maps.Size(24, 35); 

            // 마커 이미지를 생성   
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 

            // 마커를 생성
            var marker = new kakao.maps.Marker({
                map: home_map, // 마커를 표시할 지도
                position: favorite_positions[i].latlng, // 마커를 표시할 위치
                title : favorite_positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시
                image : markerImage, // 마커 이미지 
                clickable: true // 지도의 클릭이벤트가 발생하지 않도록 함 
            });

            // 위도 경도 좌표값 주소로 변환하기 (안된다)
            /*var geocoder = new kakao.maps.services.Geocoder();
            var x = favorite_positions[i].latlng.getLng();
            var y = favorite_positions[i].latlng.getLat();
            var address; 
            var latlng_transform = function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    address = "도로명 주소: " + result[0].address_name;    
                }
            }
            geocoder.coord2RegionCode(x, y, latlng_transform);*/

             // 지도 아래 공연 정보 추가: 공연 이름, 주소 정보 (좌표값을 주소로 변환)
            var live_inform = document.createTextNode("공연 이름: " + favorite_positions[i].title);
            live_inform.id = favorite_positions[i].title
            document.getElementById('inform_list').appendChild(live_inform);
        }       
        
        // 일반 공연 마커: normal_positions
        var normal_positions = [
            {
                title: '일반 공연1',  // title은 공연 이름으로 
                latlng: new kakao.maps.LatLng(33.450879, 126.569940)
            },
            {
                title: '일반 공연2', 
                latlng: new kakao.maps.LatLng(33.451393, 126.570738)
            },
        ];
        
        
        for (var i = 0; i < normal_positions.length; i ++) {
            // 마커를 생성
            var marker = new kakao.maps.Marker({
                map: home_map, // 마커를 표시할 지도
                position: normal_positions[i].latlng, // 마커를 표시할 위치
                title : normal_positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시
            });

            // 지도 아래 공연 정보 추가: 공연 이름, 주소 정보 (좌표값을 주소로 변환)
            var live_inform = document.createTextNode("공연 이름: " + normal_positions[i].title + "\n");
            live_inform.id = normal_positions[i].title
            document.getElementById('inform_list').appendChild(live_inform);
        };
        
        // 마커 누르면 지도 아래 해당 공연 정보 색 바뀜 
        // 왜 안되지 ㅠ  
        kakao.maps.event.addListener(marker, 'click', function() {   
            var live = document.getElementById(marker.title)
            live.style.backgroundColor = 'red';
        });

	</script>

    

</body>
</html>